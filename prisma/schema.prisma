generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                 @id @default(autoincrement())
  email             String              @unique
  name              String?
  password          String
  accountVerified   Boolean             @default(false)
  resetToken        String?
  resetTokenExpiry  DateTime            @default(now())
  createdAt         DateTime            @default(now())
  profilePhoto      String?
  role              String              @default("user")
  GameSessionPlayer GameSessionPlayer[]
  PlayerGameProfile PlayerGameProfile[]
}

model Game {
  id                Int                 @id @default(autoincrement())
  name              String
  maxPlayer         Int
  minPlayer         Int
  thumbnail         String?
  GameSession       GameSession[]
  PlayerGameProfile PlayerGameProfile[]
}

model PlayerGameProfile {
  id              Int  @id @default(autoincrement())
  gameID          Int
  playerID        Int
  highScore       Int  @default(0)
  totalPlayedTime Int  @default(0)
  gameCount       Int  @default(0)
  game            Game @relation(fields: [gameID], references: [id])
  player          User @relation(fields: [playerID], references: [id])

  @@unique([gameID, playerID])
}

model GameSession {
  id                Int                 @id @default(autoincrement())
  gameID            Int
  status            Status              @default(WAITING)
  winner            String?
  game              Game                @relation(fields: [gameID], references: [id])
  GameSessionPlayer GameSessionPlayer[]
}

model GameSessionPlayer {
  id          Int         @id @default(autoincrement())
  sessionID   Int
  playerID    Int
  player      User        @relation(fields: [playerID], references: [id])
  gameSession GameSession @relation(fields: [sessionID], references: [id])
}

enum Role {
  ADMIN
  USER
}

enum Status {
  WAITING
  PLAYING
  LEFT
  FINISHED
}
