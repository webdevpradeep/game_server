generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Roles {
  ADMIN
  USER
}

// Define your models here
model User {
  id                Int                 @id @default(autoincrement())
  email             String              @unique
  name              String?
  Role              Roles               @default(USER)
  password          String
  accountVerified   Boolean             @default(false)
  resetToken        String?
  tokenExpiry       DateTime?
  profilePhoto      String?
  createdAt         DateTime            @default(now())
  PlayerGameProfile PlayerGameProfile[]
  GameSessionPlayer GameSessionPlayer[]
}

model Game {
  id                Int                 @id @default(autoincrement())
  name              String
  maxPlayer         Int
  minPlayer         Int
  thumbnail         String?
  PlayerGameProfile PlayerGameProfile[]
  GameSession       GameSession[]
}

model PlayerGameProfile {
  id              Int  @id @default(autoincrement())
  gameID          Int
  game            Game @relation(fields: [gameID], references: [id])
  playerID        Int
  player          User @relation(fields: [playerID], references: [id])
  highScore       Int  @default(0)
  totalPlayedTime Int  @default(0)
  gameCount       Int  @default(0)

  @@unique([gameID, playerID])
}

enum Status {
  WAITING
  PLAYING
  LEFT
  FINISHED
}

model GameSession {
  id                Int                 @id @default(autoincrement())
  gameID            Int
  game              Game                @relation(fields: [gameID], references: [id])
  status            Status              @default(WAITING)
  winner            String?
  GameUrl           String?
  ProcessID         Int?
  CreatedAt         DateTime            @default(now())
  StartedAt         DateTime?
  GameSessionPlayer GameSessionPlayer[]
}

model GameSessionPlayer {
  id          Int         @id @default(autoincrement())
  sessionID   Int
  gameSession GameSession @relation(fields: [sessionID], references: [id])
  playerID    Int
  player      User        @relation(fields: [playerID], references: [id])

  @@unique([sessionID, playerID])
}